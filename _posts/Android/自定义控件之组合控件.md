---
title: 自定义控件之组合控件
description: <center>好记性不如烂笔头</center>
categories:
 - Android
tags: 基础知识
updated: 2019-12-25 10:04:54
---

#### 概述

日常开发中经常会有这样的需求，组合多个控件。这样既是顺应设计需求，也能是有减少代码工作量、重用控件、解耦等好处。因此，将自定义组合控件的步骤记录下来。毕竟好记性不如烂笔头！

#### 步骤

- **1.**定义一个类，并继承`ViewGroup`或者它的子类如`RelativeLayout`，`LinearLayout`等

- **2.**实现构造方法

- **3.**加载需要将控件组合起来的布局

- **4.**找到并绑定布局中的控件

- **5.**为控件赋值。方式有两种：

  - （1）.通过`XML`赋值（p.s：继续步骤6、7、8、9）
  - （2）.在代码中写一个`public`方法供外界调用赋值

- **6.**在values目录下新建`attrs.xml`文件，并在文件中指定我们需要的属性，如：

  ```xml
  <?xml version="1.0" encoding="utf-8"?>
  <resources>
      <declare-styleable name="LoadingButton">
          //name属性可随意填，最好起对应属性的名字
          //format属性是这个attr的数据类型，具体有boolean、string、integer、float、fraction、color、dimension、reference
          <attr name="text" format="string"/>
          <attr name="loadingText" format="string"/>
          <attr name="textSize" format="dimension"/>
          <attr name="textColor" format="color|reference"/>
          <attr name="progressColor" format="color|reference"/>
      </declare-styleable>
  </resources>
  ```

  文件中`name`属性可随意填，最好起对应属性的名字；

  `format`属性是这个`attr`的数据类型，具体有：

  | 属性值    | 解析                                                         |
  | --------- | :----------------------------------------------------------- |
  | boolean   | 表示attr是布尔类型的值，取值只能是true或false                |
  | string    | 表示attr是字符串类型                                         |
  | integer   | 表示attr是整数类型，取值只能是整数，不能是浮点数             |
  | float     | 表示attr是浮点数类型，取值只能是浮点数或整数                 |
  | fraction  | 表示attr是百分数类型，取值只能以%结尾，例如30%、120.5%等     |
  | color     | 表示attr是颜色类型，例如#ff0000，也可以使用一个指向Color的资源，比如@android:color/background_dark，但是不能用0xffff0000这样的值 |
  | dimension | 表示attr是尺寸类型，例如取值16px、16dp，也可以使用一个指向类型的资源 |
  | reference | 表示attr的值只能指向某一资源的ID，例如取值@id/textView       |
  | enum      | 表示attr是枚举类型，在定义enum类型的attr时，可以将attr的format设置为enum，也可以不用设置attr的format属性，但是必须在attr节点下面添加一个或多个enum节点。取值时只能取其中一个枚举值 |
  | flag      | 表示attr是bit位标记，flag与enum有相似之处，定义了flag的attr，在设置值时，可以通过\|设置多个值，而且每个值都对应一个bit位，这样通过按位或操作符\|可以将多个值合成一个值，我们一般在用flag表示某个字段支持多个特性，需要注意的是，要想使用flag类型，不能在attr上设置format为flag，不要设置attr的format的属性，直接在attr节点下面添加flag节点即可。 |

  >细心的童鞋可能已经明白了flag与enum的差别，flag表示这几个值可以做或运算，比如dogFood，你可以叠加使用，狗狗食物可同时选牛肉、猪肉等。而狗狗的性别只能有一种。 format 可以选择多个类型 值 用  | 连接即可

- **7.**在需要引入组合控件的布局文件中添加命名空间：

  ```xml
   xmlns:app="http://schemas.android.com/apk/res-auto"
  ```

- **8.**引入组合控件

- **9.**通过`android:app`的命名方式来指定组合控件的属性

#### 实战案例

> 案例需求：组合一个登陆按钮，在点击登陆的时候显示一个progress和正在登陆文字

##### 实现步骤

- **1.**新建一个项目，样式选择Login_Activity
- **2.**